name: Runner Canary
run-name: "Introspect Runner on ${{ github.repository }} by ${{ github.actor }} with ${{ github.event_name }} (Attempt ${{ github.run_attempt }})"
#.github/workflows/custom-runner-introspect.yml

on:
  push:
    branches-ignore:
      - main
  workflow_dispatch:

#defaults:
#  run:
#    shell: zsh -l {0}

jobs:
  probe:
    runs-on: ubuntu-latest
    timeout-minutes: 11

    steps:

      - name: ‚¨áÔ∏è Checkout
        uses: actions/checkout@v4.2.2
        with:
          fetch-depth: 0
          fetch-tags: true


      - name: üõ°Ô∏è Detect Runner Type
        if: github.job.runner_name == 'ubuntu-latest'
        id: env
        uses: ./.github/actions/detect-runner-type


      - name: ‚òÅÔ∏è Hosted Infra Snapshot
        run: |
          echo "::group::üñ•Ô∏è Hosted Infra Fingerprint"
          echo "::notice title=Event::$GITHUB_EVENT_NAME"
          echo "::notice title=Branch::$GITHUB_REF_NAME"
          echo "::notice title=OS:: $(cat /etc/os-release || true)"
          echo "::notice title=Kernel::$(uname -a || true)"
          echo "::notice title=Memory::$(free -h || true)"
          echo "::notice title=CPU::$(nproc) cores, $(lscpu | grep 'Model name' | uniq || true)"
          echo "::endgroup::"


      - name: üß™ Toolchain Validation (Self-hosted)
        if: steps.env.outputs.is-self-hosted == 'true'
        timeout-minutes: 7
        uses: ./.github/actions/introspect-runner
        with:
          details: ${{ github.event.inputs.full-host-report }}
          labels: ${{ toJson(runner.labels) }}

